name: æ¯æ—¥ä¸­ç¾çƒ­ç‚¹æ–°é—»æ¨é€å¾®ä¿¡

on:
  schedule:
    - cron: '0 0 * * *'  # æ¯å¤© UTC 0:00 = åŒ—äº¬æ—¶é—´ 08:00ï¼ˆå¯æ”¹æ—¶é—´ï¼‰
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘æµ‹è¯•

jobs:
  fetch-and-send:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install feedparser requests

      - name: Run news fetch and send script
        env:
          SCKEY: ${{ secrets.SCKEY }}
        run: python -c "
import feedparser
import requests
import json
from datetime import datetime

sckey = '${{ secrets.SCKEY }}'
if not sckey:
    print('Error: SCKEY not set!')
    exit(1)

# ä¸­å›½çƒ­ç‚¹ï¼šç”¨ä»Šæ—¥å¤´æ¡ RSSï¼ˆTop 3ï¼‰
cn_feed = feedparser.parse('https://www.toutiao.com/search_feed/?keyword=%E7%83%AD%E7%82%B9')
cn_entries = cn_feed.entries[:3] if 'entries' in cn_feed else []
cn_text = 'ğŸ‡¨ğŸ‡³ ä¸­å›½çƒ­ç‚¹ï¼š\\n' + '\\n'.join([f'â€¢ {e.title[:50]}... [{e.link}]({e.link})' for e in cn_entries]) if cn_entries else 'æš‚æ— çƒ­ç‚¹'

# ç¾å›½çƒ­ç‚¹ï¼šç”¨ Google News US RSSï¼ˆTop 3ï¼‰
us_feed = feedparser.parse('https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en')
us_entries = us_feed.entries[:3] if 'entries' in us_feed else []
us_text = 'ğŸ‡ºğŸ‡¸ ç¾å›½çƒ­ç‚¹ï¼š\\n' + '\\n'.join([f'â€¢ {e.title[:50]}... [{e.link}]({e.link})' for e in us_entries]) if us_entries else 'æš‚æ— çƒ­ç‚¹'

# ç»„è£…æ¶ˆæ¯
today = datetime.now().strftime('%Y-%m-%d')
title = f'ğŸ“® æ¯æ—¥ä¸­ç¾çƒ­ç‚¹é€Ÿé€’ {today}'
desp = f'{cn_text}\\n\\n{us_text}\\n\\n---\\nPowered by GitHub Actions & Grok'

# å‘é€åˆ° Serveré…±ï¼ˆå¾®ä¿¡ï¼‰
response = requests.post(f'https://sctapi.ftqq.com/{sckey}.send', data={
    'title': title,
    'desp': desp
})
print(f'Status: {response.status_code} - {response.text}')
          "
