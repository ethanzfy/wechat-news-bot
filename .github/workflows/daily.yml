name: æ¯æ—¥ä¸­ç¾çƒ­ç‚¹æ–°é—»æ¨é€å¾®ä¿¡

on:
  schedule:
    - cron: '0 0 * * *'  # åŒ—äº¬æ—¶é—´ 8:00 è‡ªåŠ¨è¿è¡Œ
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  fetch-and-send:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install feedparser requests

      - name: Run news fetch and send script
        env:
          SCKEY: ${{ secrets.SCKEY }}
        run: |
          python -c "
          import feedparser
          import requests
          from datetime import datetime

          sckey = '$SCKEY'
          if not sckey or sckey == 'None':
              print('Error: SCKEY not set! è¯·æ£€æŸ¥ Settings > Secrets')
              exit(1)

          # ä¸­å›½çƒ­ç‚¹ï¼šç™¾åº¦æ–°é—» RSS (Top 3)
          try:
              cn_feed = feedparser.parse('https://feedx.net/rss/baidu.xml')
              cn_entries = cn_feed.entries[:3] if 'entries' in cn_feed else []
              cn_text = 'ğŸ‡¨ğŸ‡³ ä¸­å›½çƒ­ç‚¹ï¼š\n' + '\n'.join([f'â€¢ {e.title[:50]}... \n  {e.link}' for e in cn_entries]) if cn_entries else 'æš‚æ— çƒ­ç‚¹'
          except Exception as e:
              cn_text = f'ğŸ‡¨ğŸ‡³ ä¸­å›½çƒ­ç‚¹ï¼šåŠ è½½å¤±è´¥ ({e})'

          # ç¾å›½çƒ­ç‚¹ï¼šGoogle News RSS (Top 3)
          try:
              us_feed = feedparser.parse('https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en')
              us_entries = us_feed.entries[:3] if 'entries' in us_feed else []
              us_text = 'ğŸ‡ºğŸ‡¸ ç¾å›½çƒ­ç‚¹ï¼š\n' + '\n'.join([f'â€¢ {e.title[:50]}... \n  {e.link}' for e in us_entries]) if us_entries else 'æš‚æ— çƒ­ç‚¹'
          except Exception as e:
              us_text = f'ğŸ‡ºğŸ‡¸ ç¾å›½çƒ­ç‚¹ï¼šåŠ è½½å¤±è´¥ ({e})'

          # ç»„è£…æ¶ˆæ¯
          today = datetime.now().strftime('%Y-%m-%d')
          title = f'ğŸ“® æ¯æ—¥ä¸­ç¾çƒ­ç‚¹é€Ÿé€’ {today}'
          desp = f'{cn_text}\n\n{us_text}\n\n---\nğŸ• æ›´æ–°äº {datetime.now().strftime("%H:%M")} | Powered by GitHub Actions'

          # å‘é€åˆ° Serveré…±ï¼ˆå¾®ä¿¡ï¼‰
          response = requests.post(f'https://sctapi.ftqq.com/{sckey}.send', data={
              'title': title,
              'desp': desp
          })
          print(f'æ¨é€çŠ¶æ€: {response.status_code}')
          if response.status_code == 200:
              print('âœ… å¾®ä¿¡æ¨é€æˆåŠŸï¼')
          else:
              print(f'âŒ æ¨é€å¤±è´¥: {response.text}')
          "
