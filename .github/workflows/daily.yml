name: æ¯æ—¥ä¸­ç¾çƒ­ç‚¹æ–°é—»æ¨é€å¾®ä¿¡

on:
  schedule:
    - cron: '0 0 * * *'  # åŒ—äº¬æ—¶é—´ 8:00
  workflow_dispatch:

jobs:
  send-news:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install deps
        run: pip install feedparser requests

      - name: Run script
        env:
          SCKEY: ${{ secrets.SCKEY }}
        run: |
          python - << 'PY'
import feedparser
import requests
from datetime import datetime

sckey = "${{ secrets.SCKEY }}".strip()
if not sckey:
    print("SCKEY æœªè®¾ç½®ï¼")
    exit(1)

# ä¸­å›½çƒ­ç‚¹ - å¾®åšçƒ­æœ
try:
    cn = feedparser.parse("https://rsshub.app/weibo/search/hot").entries[:3]
    cn_lines = [f"â€¢ {e.title.split('[')[0][:45]}...\n  {e.link}" for e in cn]
    cn_text = "ğŸ‡¨ğŸ‡³ ä¸­å›½çƒ­ç‚¹ï¼š\n" + "\n".join(cn_lines)
except Exception as e:
    cn_text = f"ğŸ‡¨ğŸ‡³ ä¸­å›½çƒ­ç‚¹ï¼šåŠ è½½å¤±è´¥ ({e})"

# ç¾å›½çƒ­ç‚¹ - Google News
try:
    us = feedparser.parse("https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en").entries[:3]
    us_lines = [f"â€¢ {e.title.split(' - ')[0][:45]}...\n  {e.link}" for e in us]
    us_text = "ğŸ‡ºğŸ‡¸ ç¾å›½çƒ­ç‚¹ï¼š\n" + "\n".join(us_lines)
except Exception as e:
    us_text = f"ğŸ‡ºğŸ‡¸ ç¾å›½çƒ­ç‚¹ï¼šåŠ è½½å¤±è´¥ ({e})"

# ç»„è£…æ¶ˆæ¯
today = datetime.now().strftime("%Y-%m-%d")
time = datetime.now().strftime("%H:%M")
title = f"æ¯æ—¥çƒ­ç‚¹é€Ÿé€’ {today}"
desp = f"{cn_text}\n\n{us_text}\n\n---\næ›´æ–°äº {time} | GitHub Actions"

# å‘é€
resp = requests.post(f"https://sctapi.ftqq.com/{sckey}.send", data={"title": title, "desp": desp})
print(f"æ¨é€çŠ¶æ€: {resp.status_code}")
if resp.status_code == 200:
    print("å¾®ä¿¡æ¨é€æˆåŠŸï¼")
else:
    print(f"æ¨é€å¤±è´¥: {resp.text}")
PY
